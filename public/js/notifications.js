function getFreqs(){return $.get("ajax/friend-requests/count",function(a){freqs=parseInt(a),freqs>0?$(".friend-bubble").text(a).show():$(".friend-bubble").hide()})}function getMessageNotifications(){return $.get("ajax/conversations/count",function(a){messageNotifications=parseInt(a),messageNotifications>0?$(".message-bubble").text(a).show():$(".message-bubble").hide()})}function getNotifications(){return $.get("ajax/notifications/count",function(a){notifications=parseInt(a),notifications>0?$(".notification-bubble").text(a).show():$(".notification-bubble").hide()})}function getFeed(){$.getJSON("ajax/feed"+id,function(a){$("#feed").empty(),a.length>0?$.each(a,function(a,b){var c=b.updated_at;null==c&&(c=b.created_at),$("<div/>").addClass("col-md-12").addClass("post").html('<div class="header">'+b.organisation.name+'</div><div class="content">'+b.content+'</div><div class="footer">'+c+"</div>").appendTo("#feed")}):$("#feed").append('<div class="col-md-12"><p class="text-center">No posts yet.</p></div>')})}function feedExpand(a){$.getJSON("ajax/feed/extend"+id,{offset:offset},function(b){b.length>0&&$.each(b,function(a,b){var c=b.updated_at;null==c&&(c=b.created_at),$post='<div class="col-md-12 post"><div class="header">'+b.organisation.name+'</div><div class="content">'+b.content+'</div><div class="footer">'+b.created_at+"</div></div>",$("#feed-ext").append($post)}),a.html("Load more"),offset++,canExpandFeed()})}function canExpandFeed(){$.get("ajax/feed/can-expand"+id,{offset:offset},function(a){a=parseInt(a),a||$(".load-feed").remove()})}function notificationSeen(a){$.get("ajax/notifications/"+a.data("notification-id")+"/seen",function(){a.find("i.fa-circle").removeClass("fa-circle").addClass("fa-circle-o")})}function bubbleHandler(){getFreqs().then(function(){getNotifications().then(function(){getMessageNotifications().then(function(){notifications+messageNotifications+freqs>0?$(".excl-bubble").show():$(".excl-bubble").hide()})})})}var offset=1,id,canExpand,notifications=messageNotifications=freqs=0;$(function(){bubbleHandler(),setInterval(function(){bubbleHandler()},5e3),$("#feed").length>0&&setInterval(function(){getFeed()},5e3),$("#feed").length>0&&(id="",$("#feed").data("organisation")>0&&(id="/"+$("#feed").data("organisation")),$(".load-feed.btn-load").click(function(a){a.preventDefault(),$(this).html('<i class="fa fa-circle-o-notch fa-spin"></i>'),feedExpand($(this))})),$(".post a.toggleSeen").click(function(a){a.preventDefault(),notificationSeen($(this).closest(".post"))}),$(".post .content a").click(function(a){notificationSeen($(this).closest(".post"))}),canExpandFeed()});